#include "types.h"
#include "tile/coordinate.h"
#include "constants/map_namespaces.h"
#include "worldmap.h"
#include "map/header.h"
#include "constants/map_types.h"
#include "constants/map_connections.h"
#include "debug.h"
#include "math.h"
#include "save.h"

u8 worldmap0_position_data [] = {
    //   [0]   [1]   [2]  [3]   [4]   [5]   [6]   [7]   [8]   [9]    [A]  [B]   [C]   [D]   [E]    [F]  [10]  [11]  [12]  [13]  [14]
        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 0x6d, 0x6d, 0x6d, 0x5a, 

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 0x6d, ____, ____, 0x6e, 

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 0x60, ____, ____, 0x6e, 

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 0x6c, ____, ____, 0x6e,

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 0x7e, ____, ____, 0x87,

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 0x8a, ____, 0x81, ____, ____, ____, 0x66, 0x5b, 0x67, 0x67, 0x5c,

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 0x5e, 0x6a, 0x6a, 0x6a, 0x5d, 0x69, 0x7a, ____, ____, ____, 0x68,

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 0x7a, ____, ____, ____, 0x68,

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 0x7a, 0x7a, 0x7a, 0x7a, 0x59,

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 0x6f, ____, ____, ____, 0x65,

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 0x6f, ____, ____, 0xa2, 0x65,

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 0x6e, 0x70, 0x70, 0x70, 0x5f, 0x7F, ____, ____, 0x58,

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 


        //Upper layer

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 

        ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, ____, 


};

void worldmap_locate_player() {
	u8 bank = save1->bank;
	u8 map_idx = save1->map;
	s16 x = save1->x_cam_orig;
	s16 y = save1->y_cam_orig;
	map_header_t *header = get_mapheader(bank, map_idx);
	int width = (int)(header->footer->width);
	int height = (int)(header->footer->height);
	
	worldmap_state->player_namespace = get_mapheader(bank, map_idx)->map_namespace;
	int segment_width = MAX(1, width / worldmap_positions[bank][map_idx].width);
	int segment_height = MAX(1, height / worldmap_positions[bank][map_idx].height);
	int segment_x = x / segment_width;
	int segment_y = y / segment_height;
	worldmap_state->cursor_x = (u16)(worldmap_positions[bank][map_idx].x + segment_x);
	worldmap_state->cursor_y = (u16)(worldmap_positions[bank][map_idx].y + segment_y);
	// dprintf("Map width %d, height %d\n", width, height);
	// dprintf("Segment width %d, height %d\n", segment_width, segment_height);
	// dprintf("Segment x %d, y %d\n", segment_x, segment_y);
}